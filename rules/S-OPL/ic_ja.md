

[日本語](./ic_ja.md) | [English](./ic_en.md)

# Interactive Cleanup（IC）

参考動画：[Interactive Cleanup参考動画](https://youtu.be/HHMxg-a5puo)

> [!NOTE]
> 参考動画は完璧ではありません．開催年度のルールによってタスク内容が異なる可能性があるので，あくまで参考程度にしてください．
> 気になる点や議論したい点などがありましたら，GitHubの[Issues](https://github.com/RoboCupAtHomeJP/AtHome2025/issues)にてご記入ください．


## 概要
このタスクは，ロボットが指差しジェスチャを理解する能力を評価するものです．Handyman タスクと同様に，障害物回避を伴うナビゲーション，物体認識，物体操作，人間検出などの基本機能が要求されます．さらに，ロボットは指示内容だけでなく，人間のアバターの行動にも注意を払う必要があります．指差しジェスチャの動作は全チームに公平に配分され，数回のセッションが繰り返されるため，ロボットの性能を統計的に評価することができます．

## セットアップ
- **システム構成**:
  - 本競技ではシミュレーション環境を実行するWindows PCと，各チームが開発するロボットコントローラを実行するUbuntu PCでrosbridge serverを介した通信を行う．これにより，ロボットのセンサデータの取得や，アバターとロボットのインタラクションを行う．
- **Interactive Cleanup-Windows**:
  - シミュレーション環境を実行するWindows PCでは，UnityとSIGVerseをベースにHuman navigationソフトウェアを実行する．このソフトウェアは，JointState，TF，センサー情報，その他のROSメッセージを一定間隔でロボットコントローラに送信する．セットアップ手順は[こちら](https://github.com/RoboCupatHomeSim/interactive-cleanup-unity)．
- **ロボットコントローラ-Ubuntu**: 
  - 各チームはUbuntu環境において，Human navigationタスクを行うためのロボット制御プログラムの開発を行う．TwistやJointTrajectory，その他のROSメッセージを送信することでロボットを制御する．Ubuntu環境のセットアップ手順は[こちら](https://wiki.ros.org/noetic/Installation/Ubuntu)．

## 競技の構成
競技の流れは以下の通りです．

1. チームメンバーがSIGVerse ROSBridgeサーバ，ロボットコントローラを起動する．

2. 技術委員(OC)がInteractive Cleanup プログラムを起動する．

3. ロボットと把持するオブジェクトの位置・姿勢を初期化する．

4. モデレータがロボットに対して"Are_you_ready?"メッセージを送信する．

5. ロボットがモデレータに"I_am_ready"メッセージを送信する．

6. アバターは移動し、ロボットが把持するべきオブジェクトを指し示す．この時，モデレータがロボットに"Pick_it_up!"メッセージを送信する．

7. アバターは移動し、オブジェクトを置くべき場所を指し示す．この時，モデレータがロボットに"Clean_up!メッセージを送信する．

8. アバターは初期位置に戻る．

9. ロボットはオプションで再指示を要求することができる．
    - ロボットが"Point_it_again"メッセージを送信した場合，このステップが繰り返されます．（再指示）

10. ロボットは移動し目的のオブジェクトを掴む．

11. オブジェクトが正しいかどうかの確認をオプションで行うことができる．
    - ロボットがオブジェクトを掴んだ後，"Is_this_correct?"メッセージを送信し，アバターが"Yes/No"で応答する．ただし，確認ごとに減点される．

12. ロボットは"Object_grasped"メッセージをアバターに送信し，オブジェクトが正しい場合，得点が加算される．

13. ロボットは移動してオブジェクトを目的地に置く．

14. ロボットは"Task_finished"メッセージをモデレータに送信する．

15. 各セッションは以下のイベントによって終了する．
- **目標物が目的地に設置される場合**:
  - モデレータからロボットに"Task_succeeded"が送信される．
- **ロボットから"Give_up"が送信される場合**:
  - タスクが達成できない場合，ロボットは"Give_up"メッセージを送ることができる．
  - その場合，セッションは中断され，モデレータは"Task_failed"メッセージをロボットに送信する．
- **時間切れの場合**:
  - モデレータはロボットに"Task_failed"メッセージを送信する．
- **セッションが残っていない場合**:
  - モデレータはロボットに"Mission_complete"メッセージを送信し，競技を終了する．
- **セッションが残っている場合**:
  - ステップ3に戻る．

> [!Tip]
> 詳細はGithubの[wiki](https://github.com/RoboCupatHomeSim/interactive-cleanup-unity/wiki/SystemOverview)を参照してください．

## セッション数と制限時間
タスクは**10**セッションで構成され，各セッションの制限時間は**6**分です．
またセンサー情報がロボットに配信された時点で制限時間のタイマーが開始されます．

## スコアシート

<table>
  <tr>
    <th> <b>Action</b> </th>
    <th> <b>Score</b> </th>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b>メインタスク</b> </td>
  </tr>
  <tr>
    <td> ロボットが正しく把持対象物体を把持する <br> 
      ロボットが対象物の廃棄や再配置に成功する<br> 
    </td>
    <td align="center"> 50 <br> 50 </td>
  </tr>
  <tr>
    <td colspan="2" align="center"> <b> ペナルティ </b> </td>
  </tr>
  <tr>
  <tr>
    <td>ロボットが把持対象物体を誤って把持する<br>
    ロボットが対象物の廃棄や再配置を誤る<br>
    ロボットがオブジェクトの正否を確認する（各回）<br>
    ロボットが物体に衝突する（各回） <br>
    ロボットが把持・解放した物体が他の物体と衝突する（各回）<br>
    ロボットが指差しジェスチャの繰り返しを要求する（各回）
    </td>
    <td align="center"> -10 <br> -10 <br> -10 <br> -10 <br> 0 <br> 0 </td>
  </tr>
  <tr>
    <td> <b>総得点 (ペナルティ，ボーナスを除く) （1セッション当たり）</b> </td>
    <td align="center"> <b>100</b> </td>
  </tr>
</table>

セッションのスコアは，セッション中の上記スコアの合計として算出されます．多くの減点を重ねて，セッションの点数が0点を下回った場合，そのセッションは0点として扱います．Interactive Cleanup の総スコアは，すべてのセッションスコアの合計として計算されます．

## 競技画面
Unity の競技中の画面の例を下図に示します．
<div align="center"><img src="./img/ic_2.png" width="80%"></div>

各コンポーネントの意味は，GitHubの[wiki](https://github.com/RoboCupatHomeSim/interactive-cleanup-unity/wiki/Screen)で確認できます．

## Room Layout
本競技で使用する部屋の一例を下図に示します．

<div align="center"><img src="./img/ic_3.png" width="80%"></div>

## 把持対象物体
ロボットが把持する対象物の例を下図に示します．最終的な候補物は，大会の14日前までに発表さ
れる予定です．
<div align="center"><img src="./img/ic_4.png" width="80%"></div>

## 目的地（物体の持ち運び先）
アバターは2回目の指差しジェスチャによって，ターゲットオブジェクトの行き先をロボットに指示します．目的地は家具の上かゴミ箱の中です．タスクで使用した目的地の例を下図に示します．目的地のオブジェクトリストは，大会の14日前までに発表される予定です．
<div align="center"><img src="./img/ic_5.png" width="80%"></div>

## レフェリー(OC)の動き
- 競技開始30分前に集まり，競技者とともに接続確認を行う．
- スコアシートに基づき，競技を採点する．
- 他のOCと採点内容を確認し合う．
- スコアシートを提出する．

> [!NOTE]
> OCは各チームから数名選出され，他チームの競技において上記を行ってもらう．

## 備考

### 指差しジェスチャ
アバターは2つの指差しジェスチャを行います．1つ目の指差しジェスチャと2つ目の指差しジェスチャは，それぞれ把持対象物体とその目的地を特定します．アバターは各姿勢／ジェスチャをn秒間維持します．指差しジェスチャにおいてアバターは常に人差し指を使用します．指差しジェスチャの方向は，セッションごとにランダムに決定されます．一時停止時間の持続時間の範囲は，2 ≦ n ≦ 10です．

### ロボットとアバター
ロボットとアバターの初期位置は，すべてのセッションで常に同じです．ロボットの初期姿勢は，ロボットが`HeadCenterCamera`によって人間のアバター画像を写すことができるように設定されます．